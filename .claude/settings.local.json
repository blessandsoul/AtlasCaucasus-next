{
  "permissions": {
    "allow": [
      "Bash(npm install:*)",
      "Bash(tree:*)",
      "Bash(npm run prisma:migrate:*)",
      "Bash(npx tsc:*)",
      "Bash(npm run dev:*)",
      "Bash(findstr:*)",
      "Bash(npx prisma db execute:*)",
      "Bash(ls -la \"c:\\\\Users\\\\seed\\\\Documents\\\\GitHub\\\\AtlasCaucasus\\\\server\\\\src\\\\modules\"\" | grep -E \"^d \")",
      "Bash(npm run build:*)",
      "Bash(npm run type-check:*)",
      "Bash(grep:*)",
      "Bash(npm run lint)",
      "Bash(git rm:*)",
      "Bash(npm ls:*)",
      "Bash(powershell -Command \"Set-Content -Path ''c:\\\\Users\\\\seed\\\\Documents\\\\GitHub\\\\AtlasCaucasus-next\\\\server\\\\src\\\\libs\\\\authorization.ts'' -Value @''\nimport type { JwtUser } from \"\"../modules/auth/auth.types.js\"\";\nimport type { UserRole } from \"\"../modules/users/user.types.js\"\";\nimport { ForbiddenError, NotFoundError } from \"\"./errors.js\"\";\nimport { getTourById } from \"\"../modules/tours/tour.repo.js\"\";\nimport { findById as getCompanyById } from \"\"../modules/companies/company.repo.js\"\";\nimport { findById as getGuideById } from \"\"../modules/guides/guide.repo.js\"\";\nimport { findById as getDriverById } from \"\"../modules/drivers/driver.repo.js\"\";\n\n// ==========================================\n// ROLE CHECK HELPERS\n// ==========================================\n\n/**\n * Check if user has ADMIN role\n */\nexport function isAdmin\\(user: JwtUser\\): boolean {\n  return user.roles.includes\\(\"\"ADMIN\"\"\\);\n}\n\n/**\n * Check if user has COMPANY role\n */\nexport function isCompany\\(user: JwtUser\\): boolean {\n  return user.roles.includes\\(\"\"COMPANY\"\"\\);\n}\n\n/**\n * Check if user has GUIDE role\n */\nexport function isGuide\\(user: JwtUser\\): boolean {\n  return user.roles.includes\\(\"\"GUIDE\"\"\\);\n}\n\n/**\n * Check if user has DRIVER role\n */\nexport function isDriver\\(user: JwtUser\\): boolean {\n  return user.roles.includes\\(\"\"DRIVER\"\"\\);\n}\n\n/**\n * Check if user has any of the specified roles\n */\nexport function hasAnyRole\\(user: JwtUser, roles: UserRole[]\\): boolean {\n  return roles.some\\(\\(role\\) => user.roles.includes\\(role\\)\\);\n}\n\n/**\n * Check if user has all of the specified roles\n */\nexport function hasAllRoles\\(user: JwtUser, roles: UserRole[]\\): boolean {\n  return roles.every\\(\\(role\\) => user.roles.includes\\(role\\)\\);\n}\n\n// ==========================================\n// AUTHORIZATION CONTEXT\n// ==========================================\n\nexport interface AuthContext {\n  user: JwtUser;\n  isAdmin: boolean;\n  isCompany: boolean;\n  isGuide: boolean;\n  isDriver: boolean;\n}\n\n/**\n * Create an authorization context from a JWT user\n */\nexport function createAuthContext\\(user: JwtUser\\): AuthContext {\n  return {\n    user,\n    isAdmin: isAdmin\\(user\\),\n    isCompany: isCompany\\(user\\),\n    isGuide: isGuide\\(user\\),\n    isDriver: isDriver\\(user\\),\n  };\n}\n\n// ==========================================\n// TOUR AUTHORIZATION\n// ==========================================\n\n/**\n * Assert that the current user can modify a tour\n * @throws NotFoundError if tour does not exist\n * @throws ForbiddenError if user does not have permission\n */\nexport async function assertCanModifyTour\\(\n  user: JwtUser,\n  tourId: string\n\\): Promise<void> {\n  const tour = await getTourById\\(tourId\\);\n\n  if \\(!tour\\) {\n    throw new NotFoundError\\(\"\"Tour not found\"\", \"\"TOUR_NOT_FOUND\"\"\\);\n  }\n\n  if \\(tour.ownerId !== user.id && !isAdmin\\(user\\)\\) {\n    throw new ForbiddenError\\(\n      \"\"You can only modify your own tours\"\",\n      \"\"NOT_TOUR_OWNER\"\"\n    \\);\n  }\n}\n\n/**\n * Check if user can modify a tour \\(non-throwing version\\)\n */\nexport async function canModifyTour\\(\n  user: JwtUser,\n  tourId: string\n\\): Promise<boolean> {\n  try {\n    await assertCanModifyTour\\(user, tourId\\);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ==========================================\n// COMPANY AUTHORIZATION\n// ==========================================\n\n/**\n * Assert that the current user can modify a company\n * @throws NotFoundError if company does not exist\n * @throws ForbiddenError if user does not have permission\n */\nexport async function assertCanModifyCompany\\(\n  user: JwtUser,\n  companyId: string\n\\): Promise<void> {\n  const company = await getCompanyById\\(companyId\\);\n\n  if \\(!company\\) {\n    throw new NotFoundError\\(\"\"Company not found\"\", \"\"COMPANY_NOT_FOUND\"\"\\);\n  }\n\n  if \\(company.userId !== user.id && !isAdmin\\(user\\)\\) {\n    throw new ForbiddenError\\(\n      \"\"You can only modify your own company\"\",\n      \"\"NOT_COMPANY_OWNER\"\"\n    \\);\n  }\n}\n\n/**\n * Check if user can modify a company \\(non-throwing version\\)\n */\nexport async function canModifyCompany\\(\n  user: JwtUser,\n  companyId: string\n\\): Promise<boolean> {\n  try {\n    await assertCanModifyCompany\\(user, companyId\\);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ==========================================\n// GUIDE AUTHORIZATION\n// ==========================================\n\n/**\n * Assert that the current user can modify a guide profile\n * @throws NotFoundError if guide does not exist\n * @throws ForbiddenError if user does not have permission\n */\nexport async function assertCanModifyGuide\\(\n  user: JwtUser,\n  guideId: string\n\\): Promise<void> {\n  const guide = await getGuideById\\(guideId\\);\n\n  if \\(!guide\\) {\n    throw new NotFoundError\\(\"\"Guide profile not found\"\", \"\"GUIDE_NOT_FOUND\"\"\\);\n  }\n\n  if \\(guide.userId !== user.id && !isAdmin\\(user\\)\\) {\n    throw new ForbiddenError\\(\n      \"\"You can only modify your own guide profile\"\",\n      \"\"NOT_GUIDE_OWNER\"\"\n    \\);\n  }\n}\n\n/**\n * Check if user can modify a guide \\(non-throwing version\\)\n */\nexport async function canModifyGuide\\(\n  user: JwtUser,\n  guideId: string\n\\): Promise<boolean> {\n  try {\n    await assertCanModifyGuide\\(user, guideId\\);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ==========================================\n// DRIVER AUTHORIZATION\n// ==========================================\n\n/**\n * Assert that the current user can modify a driver profile\n * @throws NotFoundError if driver does not exist\n * @throws ForbiddenError if user does not have permission\n */\nexport async function assertCanModifyDriver\\(\n  user: JwtUser,\n  driverId: string\n\\): Promise<void> {\n  const driver = await getDriverById\\(driverId\\);\n\n  if \\(!driver\\) {\n    throw new NotFoundError\\(\"\"Driver profile not found\"\", \"\"DRIVER_NOT_FOUND\"\"\\);\n  }\n\n  if \\(driver.userId !== user.id && !isAdmin\\(user\\)\\) {\n    throw new ForbiddenError\\(\n      \"\"You can only modify your own driver profile\"\",\n      \"\"NOT_DRIVER_OWNER\"\"\n    \\);\n  }\n}\n\n/**\n * Check if user can modify a driver \\(non-throwing version\\)\n */\nexport async function canModifyDriver\\(\n  user: JwtUser,\n  driverId: string\n\\): Promise<boolean> {\n  try {\n    await assertCanModifyDriver\\(user, driverId\\);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ==========================================\n// USER AUTHORIZATION\n// ==========================================\n\n/**\n * Assert that the current user can modify a user account\n * @throws ForbiddenError if user does not have permission\n */\nexport function assertCanModifyUser\\(\n  currentUser: JwtUser,\n  targetUserId: string\n\\): void {\n  if \\(targetUserId !== currentUser.id && !isAdmin\\(currentUser\\)\\) {\n    throw new ForbiddenError\\(\n      \"\"You can only modify your own account\"\",\n      \"\"NOT_USER_OWNER\"\"\n    \\);\n  }\n}\n\n/**\n * Check if user can modify a user account \\(non-throwing version\\)\n */\nexport function canModifyUser\\(\n  currentUser: JwtUser,\n  targetUserId: string\n\\): boolean {\n  return targetUserId === currentUser.id || isAdmin\\(currentUser\\);\n}\n\n// ==========================================\n// ADMIN-ONLY AUTHORIZATION\n// ==========================================\n\n/**\n * Assert that the current user is an admin\n * @throws ForbiddenError if user is not an admin\n */\nexport function assertIsAdmin\\(user: JwtUser\\): void {\n  if \\(!isAdmin\\(user\\)\\) {\n    throw new ForbiddenError\\(\n      \"\"This action requires admin privileges\"\",\n      \"\"ADMIN_REQUIRED\"\"\n    \\);\n  }\n}\n\n/**\n * Assert that the current user has a specific role\n * @throws ForbiddenError if user does not have the role\n */\nexport function assertHasRole\\(user: JwtUser, role: UserRole\\): void {\n  if \\(!user.roles.includes\\(role\\)\\) {\n    throw new ForbiddenError\\(\n      \"\"This action requires the \"\" + role + \"\" role\"\",\n      role + \"\"_REQUIRED\"\"\n    \\);\n  }\n}\n\n/**\n * Assert that the current user has any of the specified roles\n * @throws ForbiddenError if user does not have any of the roles\n */\nexport function assertHasAnyRole\\(user: JwtUser, roles: UserRole[]\\): void {\n  if \\(!hasAnyRole\\(user, roles\\)\\) {\n    throw new ForbiddenError\\(\n      \"\"This action requires one of the following roles: \"\" + roles.join\\(\"\", \"\"\\),\n      \"\"INSUFFICIENT_ROLE\"\"\n    \\);\n  }\n}\n''@\")",
      "Bash(ls -la \"c:\\\\Users\\\\seed\\\\Documents\\\\GitHub\\\\AtlasCaucasus-next\\\\server\\\\docker\\\\init\"\" 2>/dev/null || dir \"c:UsersseedDocumentsGitHubAtlasCaucasus-nextserverdockerinit\"\")",
      "Bash(npx prisma migrate dev:*)",
      "Bash(npx prisma generate:*)",
      "Bash(wc:*)",
      "Bash(npx prisma migrate:*)",
      "mcp__plugin_playwright_playwright__browser_navigate",
      "mcp__plugin_playwright_playwright__browser_fill_form",
      "mcp__plugin_playwright_playwright__browser_click",
      "Bash(npx tsx:*)",
      "mcp__plugin_playwright_playwright__browser_close",
      "Bash(node scripts/generate-noise.js:*)",
      "mcp__plugin_playwright_playwright__browser_wait_for",
      "mcp__plugin_playwright_playwright__browser_type",
      "mcp__plugin_playwright_playwright__browser_snapshot",
      "Bash(powershell:*)",
      "mcp__plugin_playwright_playwright__browser_file_upload",
      "mcp__plugin_playwright_playwright__browser_take_screenshot",
      "mcp__plugin_playwright_playwright__browser_press_key",
      "Bash(timeout:*)",
      "Bash(curl:*)",
      "Bash(npx ts-node:*)",
      "Bash(node -e:*)",
      "mcp__plugin_playwright_playwright__browser_evaluate",
      "Bash(npm run setup:test-accounts:*)",
      "Bash(redis-cli:*)",
      "Bash(docker compose exec:*)",
      "Bash(docker compose restart:*)",
      "Bash(docker compose:*)",
      "Bash(tasklist:*)",
      "Bash(docker exec:*)",
      "Bash(docker ps:*)",
      "mcp__plugin_playwright_playwright__browser_tabs",
      "mcp__plugin_playwright_playwright__browser_run_code",
      "mcp__plugin_playwright_playwright__browser_console_messages",
      "mcp__plugin_playwright_playwright__browser_install",
      "mcp__plugin_playwright_playwright__browser_network_requests",
      "Bash(__NEW_LINE_8dd018751120ff2d__ echo \"1. Search with SQL injection payload - full response:\")",
      "Bash(__NEW_LINE_154524167cd9b04b__ echo \"\")",
      "Bash(__NEW_LINE_88c0703f37db7c41__ echo \"1. Search with SQL injection payload - full response:\")",
      "Bash(__NEW_LINE_88c0703f37db7c41__ echo \"\")",
      "mcp__plugin_playwright_playwright__browser_resize",
      "Bash(npm run pre-production:check:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push)",
      "Bash(dir:*)",
      "Bash(git push:*)"
    ]
  }
}
